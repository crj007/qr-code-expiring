<!DOCTYPE html>
<html>
<head>
    <title>Document Access</title>
    <script>
        // 1. Parse URL parameters
        const urlParams = new URLSearchParams(window.location.search);
        const requestedFile = urlParams.get('file');
        const expiryISO = urlParams.get('expiry');
        
        // 2. Validate parameters
        if (!requestedFile || !expiryISO) {
            showError("Invalid link format");
            throw new Error("Missing parameters");
        }
        
        // 3. Check expiry
        const expiryDate = new Date(expiryISO);
        const now = new Date();
        
        if (now > expiryDate) {
            showError(
                `This link expired on ${expiryDate.toLocaleString()}`,
                "‚è∞ Time Limit Expired"
            );
            throw new Error("Link expired");
        }
        
        // 4. List of allowed files
        const allowedFiles = [
            "CS0478_solutions.pdf",
            "DOC-20250613-WA0001.pdf"
        ];
        
        // 5. Validate file
        if (!allowedFiles.includes(requestedFile)) {
            showError(
                `Requested file not found. Valid files: ${allowedFiles.join(", ")}`,
                "Invalid Request"
            );
            throw new Error("Invalid file");
        }
        
        // 6. Redirect to PDF (with cache busting)
        window.location.href = `${requestedFile}?t=${now.getTime()}`;
        
        // Helper function
        function showError(message, title = "Error") {
            document.body.innerHTML = `
                <div style="
                    max-width: 600px;
                    margin: 50px auto;
                    padding: 30px;
                    background: #fff8f8;
                    border: 1px solid #ffdddd;
                    border-radius: 8px;
                    text-align: center;
                    font-family: Arial, sans-serif;
                ">
                    <h1 style="color: #d32f2f;">${title}</h1>
                    <p>${message}</p>
                    <p><small>Generated at: ${now.toLocaleString()}</small></p>
                </div>
            `;
        }
    </script>
</head>
<body>
    <p>Verifying access...</p>
</body>
</html>
